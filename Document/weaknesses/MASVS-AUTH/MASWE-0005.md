---
title: アプリパッケージにハードコードされた API キー (API Keys Hardcoded in the App Package)
id: MASWE-0005
alias: api-keys-hardcoded-app-package
platform: [android, ios]
profiles: [L1, L2]
mappings:
  masvs-v2: [MASVS-AUTH-1]
  mastg-v1: []
  cwe: [798]
  android-risks:
  - https://developer.android.com/privacy-and-security/risks/insecure-api-usage
status: new
refs:
- https://cloud.google.com/docs/authentication/api-keys#securing
- https://cloud.google.com/docs/authentication/api-keys#api_key_restrictions
---

## 概要

アプリパッケージ、ソースコード、またはコンパイルされたバイナリにハードコードされた API キーは、リバースエンジニアリングによって簡単に抽出できます。

## 影響

アプリに API キーをハードコードすると、さまざまなセキュリティ問題につながる可能性があります。以下がありますが、それらに制限されません。

- **金銭的損失**: 攻撃者は、ハードコードされた API キーを侵害して悪用し、不正な API 呼び出しを行い、使用量に応じて課金されるサービス (AI または ML API サービスなど) を不正使用し、アプリ所有者に予期せぬ請求をもたらす可能性があります。
- **システム完全性とビジネス業務の侵害**: 抽出された API キーは、攻撃者に機密性の高いリソースやサービスへの不正アクセスを与える可能性があります。これは、アプリの完全性、プライバシー、サービスの継続性を侵害することで、開発者や企業に直接的な影響を与え、サービス拒否 (DoS) やポリシー違反によるサービス停止などの混乱につながる可能性があります。このようなインシデントはユーザーエクスペリエンスに重大な影響を及ぼし、ユーザーの信頼を失墜し、ビジネスの評判や業務に悪影響を及ぼす可能性があります。
- **保護メカニズムのバイパス**: ハードコードされた API キーはアプリの保護メカニズムのバイパスを容易にする可能性があります。攻撃者はこれを使用して、制限されたコンテンツにアクセスしたり、アプリ機能に不正操作したり、有料を意図した機能をロック解除でき、収益とユーザーエクスペリエンスの両方に影響を及ぼします。

## 流入の形態

API キーは以下の複数の領域にハードコードできます。

- **アプリのソースコード**: アプリのソースコードに直接埋め込まれます。
- **アプリのアセット**: 設定ファイル、マニフェストファイル、リソースファイルなど、最終的に配布するアプリパッケージ (一般的に APK/IPA) に同梱されるファイルに含まれます。
- **ライブラリ**: サードパーティ、ファーストパーティのライブラリやその他のアプリ依存関係の構成ファイルやソースコード。

## 緩和策

- 安全な認証、クライアントバリデーション、セッション制御を提供するステートフル API サービスを使用します。適度に短い時間 (1 時間など) で有効期限切れになる動的トークンを実装します。これはキー露出の影響を軽減できます。また、不正アクセスの試みを検出して対応するために、適切なエラー処理とログ記録を確保します。安全な OAuth フローを簡素化するために、OAuth 2.0 や、AppAuth などのセキュリティライブラリの使用を検討します。
- ステートフル API サービスが実行可能でない場合、ミドルウェアソリューション (しばしば API プロキシや API ゲートウェイとして知られています) でのステートレス API サービスの使用を検討します。これは、アプリと API エンドポイントの間のリクエストをプロキシするものです。JSON Web Tokens (JWT) と JSON Web Signature (JWS) を使用して、脆弱な静的キーをアプリケーション (クライアント) ではなくサーバーサイドに保存します。安全な鍵管理プラクティスを実施し、クラウド鍵管理サービスの使用を検討します。
- API キーをハードコードする必要がある場合、必ず必要最小限のパーミッションで設定し、露出した場合の影響を軽減します。多くのサービスではアクセス制限付きのキーを作成でき、実行できる操作を制限します。
- アプリの完全性を検証した後、実行時に API キーを取得するには、[Key Management Service](https://cloud.google.com/kms/docs/key-management-service) の使用を検討します。
- コードベースと依存関係にハードコードされた機密データがないか定期的に監査します ([gitLeaks](https://github.com/gitleaks/gitleaks) などのツールを使用するなど)。
- ホワイトボックス暗号技法を使用して、アプリ内の API キーと機密データを暗号化し、アプリがリバースエンジニアされた場合でも暗号アルゴリズムとキーが保護された状態を維持できるようにします。
- 万全ではなく、他の安全な選択肢を利用できない場合の **最後の手段として使用すべき** ですが、コードとリソースの難読化と暗号化は、アプリの解析やハードコードされたシークレットの発見をより困難にすることで、攻撃者を抑止できます。カスタム実装を避け、RASP (Runtime Application Self-Protection) などの十分に確立されたソリューションを使用すると、API キーが必要な場合にのみメモリに完全にアセンブルされ、それ以外の場合は難読化されたまま、あるいは複数のコンポーネントに分割された状態を維持できます。RASP は、安全な鍵管理ソリューションと統合することで、実行時にキーを動的に取得し、安全に管理することもできます。
